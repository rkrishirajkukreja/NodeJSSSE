<!-- index.html -->
<!DOCTYPE html>
<html>
<head>
  <title>SSE Web Page</title>
</head>
<body onload="loadRegisteredClients()">
  <table>
	<th> <h4>Register Client</h4> </th>
	<tr>
		<td><label for="clientName">Client Name:</label></td>
		<td><input type="text" id="clientName" /></td>
	</tr>
	<tr>
		<td colspan='2'><button onclick="registerClient()">Register Client</button></td>
	</tr>
  </table>  
  <br />
  <br />
  <table>
	<th><h4>Appointment Booking</h4></th>
	<tr>
		<td><label for="clientSelect">Select Client:</label></td>
		<td><select id="clientSelect"></select></td>
	</tr>
	<tr>
		<td><label for="firstName">First Name:</label></td>
		<td><input type="text" id="firstName" /></td>
	</tr>
	<tr>
		<td><label for="lastName">Last Name:</label></td>
		<td><input type="text" id="lastName" /></td>
	</tr>
	<tr>
		<td><label for="mobile">Mobile:</label></td>
		<td><input type="text" id="mobile" /></td>
	</tr>
	<tr>
		<td><label for="appointmentDateTime">Appointment DateTime:</label></td>
		<td><input type="datetime-local" id="appointmentDateTime" /></td>
	</tr>
	<tr>
		<td><label for="operatory">Operatory:</label></td>
		<td><input type="text" id="operatory" /></td>
	</tr>
	<tr>
		<td colspan='2'><button onclick="sendDataToClient()">Send Data to Client</button></td>
	</tr>
  </table>
  
  <script>
  
   function loadRegisteredClients() {
      fetch('/get-registered-clients')
        .then(response => response.json())
        .then(data => {
          const clientSelect = document.getElementById('clientSelect');
          data.clients.forEach(client => {
            const option = document.createElement('option');
            option.text = client;
            clientSelect.add(option);
          });
        })
        .catch(console.error);
    }
	
    function registerClient() {
      const clientNameInput = document.getElementById('clientName');
      const clientName = clientNameInput.value.trim();
      if (clientName === '') {
        alert('Please enter a valid client name.');
        return;
      }

      const clientSelect = document.getElementById('clientSelect');
      if (isClientNameRegistered(clientName)) {
        alert('Client name already registered.');
        return;
      }

      const option = document.createElement('option');
      option.text = clientName;
      clientSelect.add(option);
      saveClientName(clientName);
      clientNameInput.value = '';
    }
	
	
function isClientNameRegistered(clientName) {
      const clientSelect = document.getElementById('clientSelect');
      for (let i = 0; i < clientSelect.options.length; i++) {
        if (clientSelect.options[i].text === clientName) {
          return true;
        }
      }
      return false;
    }
	
	
function saveClientName(clientName) {
      fetch(`/register-client?clientName=${clientName}`)
        .then(response => response.text())
        .then(console.log)
        .catch(console.error);
    }
	
	
	function sendDataToClient() {
      const selectedClient = document.getElementById('clientSelect').value;
      const firstName = document.getElementById('firstName').value;
      const lastName = document.getElementById('lastName').value;
      const mobile = document.getElementById('mobile').value;
      const appointmentDateTime = document.getElementById('appointmentDateTime').value;
      const operatory = document.getElementById('operatory').value;

      const data = {
        firstName,
        lastName,
        mobile,
        appointmentDateTime,
        operatory,
      };

      fetch(`/send-data-to-client?client=${selectedClient}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      })
      .then(response => response.text())
      .then(console.log)
      .catch(console.error);
    }

    function sendDataToClient() {
      const selectedClient = document.getElementById('clientSelect').value;
      const firstName = document.getElementById('firstName').value;
      const lastName = document.getElementById('lastName').value;
      const mobile = document.getElementById('mobile').value;
      const appointmentDateTime = document.getElementById('appointmentDateTime').value;
      const operatory = document.getElementById('operatory').value;

      const data = {
        firstName,
        lastName,
        mobile,
        appointmentDateTime,
        operatory,
      };

      fetch(`/send-data-to-client?client=${selectedClient}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      })
      .then(response => response.text())
      .then(console.log)
      .catch(console.error);
    }
  </script>
</body>
</html>
